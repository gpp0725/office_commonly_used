
# 服务器回收计划

回收12台旧的物理机（每周回收三台物理机）//留出四台做虚拟机

- [服务器回收计划](#服务器回收计划)
  - [服务器评估](#服务器评估)
  - [服务迁移](#服务迁移)
  - [重新规划物理机](#重新规划物理机)
    - [一、重新分配物理机资源](#一重新分配物理机资源)
    - [二、 根据需求确定虚拟机系统类型](#二-根据需求确定虚拟机系统类型)
      - [RancherOS](#RancherOS)
      - [CentOS](#CentOS)
    - [三、 统一虚拟机IP地址](#三-统一虚拟机IP地址)
  - [服务回迁](#服务回迁)

## 服务器评估

1. 各组整理备份需要保留的数据
2. 评估硬件配置并记录
    1. cpu
    2. mem
    3. 磁盘disk
    4. 网络配置
3. 评估待回收服务器与其他服务器之间的关系影响，做出相应解决对策

## 服务迁移

1. 有需要迁移的服务迁移到现已搭建完成的k8s环境里
   1. 在docker环境里打包服务项目镜像
   2. 上传镜像到私有仓库
   3. 在k8s集群里使用镜像部署服务

## 重新规划物理机

### 一、重新分配物理机资源

1. 考虑一台物理机是否专门做rancher高可用集群

### 二、 根据需求确定虚拟机系统类型

#### RancherOS

1. 跳板机设计
   1. 平均每三台物理机分配两台虚拟机作为跳板机使用
      1. CPU 2c
      2. mem 8g
      3. disk 40g
2. 单独划分出一个物理机供rancher集群使用，划分出四台虚拟机（一台做负载，另外三台利用rke搭建k8s集群并在上面部署rancher高可用集群）
   1. 负载配置
      1. CPU 2c
      2. mem 8g
      3. disk 40g
   2. rancher集群配置
      1. CPU 4c
      2. mem 16g
      3. disk 100g
3. 分配k8s集群
   1. 每台物理机构建一套k8s集群
4. 考虑一个rancher高可用集群管理多少数量的k8s集群

#### CentOS

### 三、 统一虚拟机IP地址

- eg：

    | 物理机 IP  | 192.168.129.10  |
    | ---------- | --------------- |
    | 虚拟机1 IP | 192.168.129.101 |
    | 虚拟机2 IP | 192.168.129.102 |

## 服务回迁

物理机规划结束后，将部署在k8s环境里的服务进行回迁
