
# 服务器回收计划

回收12台旧的物理机（每周回收三台物理机）||留出四台做虚拟机

- [服务器回收计划](#服务器回收计划)
  - [整体类别数量分配计划](#整体类别数量分配计划)
  - [步骤](#步骤)
    - [一、服务器评估](#一服务器评估)
    - [二、服务迁移](#二服务迁移)
    - [三、回收端口](#三回收端口)
    - [四、重新规划物理机](#四重新规划物理机)
      - [统一虚拟机IP地址](#统一虚拟机IP地址)
      - [RancherOS系统设计](#RancherOS系统设计)
      - [CentOS系统设计](#CentOS系统设计)
    - [五、服务回迁](#五服务回迁)
    - [六、分配测试机](#六分配测试机)
  - [第一批](#第一批)

## 整体类别数量分配计划

| 类别           | 虚拟机数量 | 物理机IP       | cpu       | mem | 硬盘         | 备注      |
| -------------- | ---------- | -------------- | --------- | --- | ------------ | --------- |
| 跳板机         | 5          | 10.20.10.5     | 12*1.596G | 24G | 270G         | RancherOS |
| docker测试环境 | 8          | 10.20.10.4     | 12*1.596G | 64G | 3.63T        | RancherOS |
| docker测试环境 | 8          | 10.20.10.1     | 12*1.596G | 64G | 3.63T        | RancherOS |
| k8s测试        | 1          | 192.168.120.1  | 4*3.407   | 64G | 3.64T+1.8T   | RancherOS |
| k8s正式        | 1          | 10.20.10.2     | 12*1.596G | 32G | 3.63T        | RancherOS |
| 分割线         | --         | --             | --        | --  | --           | --        |
| 测试环境       | 4          | 10.20.10.3     | 12*1.596G | 32G | 3.63T        | RancherOS |
| 测试环境       | 8          | 192.168.120.80 | 12*1.596G | 32G | 3.63T+270G   | RancherOS |
| 测试环境       | 8          | 192.168.120.90 | 12*1.596G | 32G | 3.63T+270G   | RancherOS |
| 测试环境       | 8          | 192.168.120.41 | 6*1.899   | 32G | 3.63T        | CentOS    |
| 测试环境       | 8          | 192.168.120.11 | 6*1.699   | 64G | 3.64T        | CentOS    |
| 生产环境       | 4          | 192.168.120.31 | 6*1.699   | 48G | 4.36T        | CentOS    |
| 生产环境       | 4          | 192.168.120.21 | 6*1.999   | 64G | 1.8T+3.64T*2 | CentOS    |

## 步骤

### 一、服务器评估

1. 各组整理备份需要保留的数据
2. 评估硬件配置并记录
    1. cpu
    2. mem
    3. 磁盘disk
    4. 网络配置
3. 评估待回收服务器与其他服务器之间的关系影响，做出相应解决对策

### 二、服务迁移

1. 有需要迁移的服务迁移到现已搭建完成的k8s环境里
   1. 在docker环境里打包服务项目镜像
   2. 上传镜像到私有仓库
   3. 在k8s集群里使用镜像部署服务

### 三、回收端口

1. 回收未使用的端口，记录还在使用的端口，待服务器规划完毕，统一分配端口和使用

### 四、重新规划物理机

八台物理机专门做rancherOS系统，四台虚拟化CentOS

#### 统一虚拟机IP地址

- eg：

    | 物理机 IP  | 192.168.129.10  |
    | ---------- | --------------- |
    | 虚拟机1 IP | 192.168.129.100 |
    | 虚拟机2 IP | 192.168.129.101 |

#### RancherOS系统设计

1. 跳板机数量  # 跳板机只是一个登录媒介，没必要使用太多
   1. 设计五台跳板机（平均每个部门一台）
      1. CPU 2c
      2. mem 2g
      3. disk 10g
2. k8s集群设计  # 然后k8s集群只是用来部署，不管是测试还是正式，所以觉得也没必要用太多物理机
   1. 使用两台物理机分别虚拟出最大化虚拟机，加入k8s测试集群和正式集群
3. docker测试环境  
   1. CPU 2c
   2. mem 8g
   3. disk 120g

#### CentOS系统设计

略
不知道用来干嘛，做测试还是别的？

### 五、服务回迁

物理机规划结束后，将部署在k8s环境里的服务进行回迁

### 六、分配测试机

按组分配，每组大约两台

## 第一批

| 物理机IP   | 虚拟机IP    | 操作系统 | 型号        | cpu | 内存 | 硬盘 |
| ---------- | ----------- | -------- | ----------- | --- | ---- | ---- |
| 10.20.10.5 | 10.20.10.50 | Ubuntu   | ros-board50 | 2c  | 2g   | 10g  |
| 10.20.10.5 | 10.20.10.51 | Ubuntu   | ros-board50 | 2c  | 2g   | 10g  |
| 10.20.10.5 | 10.20.10.52 | Ubuntu   | ros-board50 | 2c  | 2g   | 10g  |
| 10.20.10.5 | 10.20.10.53 | Ubuntu   | ros-board5  | 2c  | 2g   | 10g  |
| 10.20.10.5 | 10.20.10.54 | Ubuntu   | ros-board54 | 2c  | 2g   | 10g  |
|            |             |          |             |     |      |      |
